/* === GLOBAL & UTILS === */
body { font-family: 'Inter', sans-serif; -webkit-font-smoothing: antialiased; overflow: hidden; }

/* Custom Scrollbar */
::-webkit-scrollbar { width: 6px; height: 6px; }
::-webkit-scrollbar-track { background: transparent; }
::-webkit-scrollbar-thumb { background: #cbd5e1; border-radius: 3px; }
::-webkit-scrollbar-thumb:hover { background: #94a3b8; }

/* Loader Animation */
.loader-dots div { animation-timing-function: cubic-bezier(0, 1, 1, 0); }
.loader-dots div:nth-child(1) { left: 8px; animation: loader-dots1 0.6s infinite; }
.loader-dots div:nth-child(2) { left: 8px; animation: loader-dots2 0.6s infinite; }
.loader-dots div:nth-child(3) { left: 32px; animation: loader-dots2 0.6s infinite; }
.loader-dots div:nth-child(4) { left: 56px; animation: loader-dots3 0.6s infinite; }
@keyframes loader-dots1 { 0% { transform: scale(0); } 100% { transform: scale(1); } }
@keyframes loader-dots3 { 0% { transform: scale(1); } 100% { transform: scale(0); } }
@keyframes loader-dots2 { 0% { transform: translate(0, 0); } 100% { transform: translate(24px, 0); } }

/* === CINEMATIC DESK SCENE === */
.desk-surface {
    position: absolute; inset: 0;
    background: radial-gradient(circle at 50% 50%, #5d4037 0%, #3e2723 80%, #1a100e 100%);
    box-shadow: inset 0 0 100px rgba(0,0,0,0.7);
    z-index: 0;
}

/* Wood Grain Effect (CSS Pattern) */
.desk-grain {
    position: absolute; inset: 0;
    opacity: 0.1;
    background-image: 
        repeating-linear-gradient(45deg, transparent, transparent 10px, #000 10px, #000 12px),
        repeating-linear-gradient(-45deg, transparent, transparent 20px, #000 20px, #000 22px);
    pointer-events: none;
}

/* Scene Objects */
.scene-object { position: absolute; pointer-events: none; filter: drop-shadow(5px 10px 10px rgba(0,0,0,0.5)); transition: transform 0.3s ease; }

.book-stack { top: 10%; left: 5%; transform: rotate(15deg); font-size: 140px; color: #4a3b32; opacity: 0.8; }
.coffee-cup { top: 15%; right: 10%; font-size: 80px; color: #d7ccc8; opacity: 0.9; transform: rotate(-10deg); }
.pen { bottom: 10%; right: 20%; font-size: 60px; color: #ffd700; transform: rotate(45deg); opacity: 0.8; }
.glasses { bottom: 15%; left: 15%; font-size: 70px; color: #94a3b8; transform: rotate(-25deg); opacity: 0.6; }

/* Interactive Stage */
.envelope-stage { 
    position: absolute; inset: 0;
    display: flex; justify-content: center; align-items: center; 
    z-index: 10;
    transition: all 1s ease;
}
.envelope-stage.zoomed-out { opacity: 0; transform: scale(2); pointer-events: none; }

/* The Envelope */
.envelope {
    position: relative; width: 320px; height: 220px; 
    background: #e11d48; /* Deep Love Red */
    border-radius: 4px;
    box-shadow: 0 20px 40px rgba(0,0,0,0.4);
    transform: rotate(-5deg);
    cursor: pointer;
    transition: transform 0.3s cubic-bezier(0.34, 1.56, 0.64, 1);
    transform-style: preserve-3d;
    animation: slideOnTable 1.5s cubic-bezier(0.25, 0.46, 0.45, 0.94) forwards;
}

@keyframes slideOnTable {
    0% { transform: translateY(120vh) rotate(20deg) scale(0.8); opacity: 0; }
    100% { transform: translateY(0) rotate(-5deg) scale(1); opacity: 1; }
}

.envelope:hover { transform: rotate(0deg) scale(1.05) translateY(-10px); box-shadow: 0 30px 60px rgba(0,0,0,0.5); }

/* Flap Logic */
.envelope-flap {
    position: absolute; top: 0; left: 0; right: 0;
    height: 0; 
    border-top: 120px solid #be123c; /* Darker flap */
    border-left: 160px solid transparent;
    border-right: 160px solid transparent;
    transform-origin: top;
    transition: transform 0.6s ease;
    z-index: 5;
}
.envelope.open .envelope-flap { transform: rotateX(180deg); z-index: 1; }

.envelope-pocket {
    position: absolute; bottom: 0; left: 0; width: 100%; height: 100%;
    z-index: 4; pointer-events: none;
    border-bottom-left-radius: 4px; border-bottom-right-radius: 4px;
    background: transparent; /* Using borders for triangles */
}
/* Left/Right Folds */
.envelope-pocket::before {
    content: ''; position: absolute; bottom: 0; left: 0;
    border-left: 160px solid #f43f5e; border-top: 110px solid transparent; border-bottom: 110px solid #f43f5e;
}
.envelope-pocket::after {
    content: ''; position: absolute; bottom: 0; right: 0;
    border-right: 160px solid #fb7185; border-top: 110px solid transparent; border-bottom: 110px solid #fb7185;
}

/* Wax Seal */
.wax-seal {
    position: absolute; top: 50%; left: 50%; transform: translate(-50%, -50%);
    width: 50px; height: 50px;
    background: radial-gradient(circle at 30% 30%, #ffd700, #b8860b);
    border-radius: 50%;
    box-shadow: 0 4px 6px rgba(0,0,0,0.3);
    z-index: 6;
    display: flex; items-center; justify-center;
    color: #8b4513; font-size: 24px;
    transition: opacity 0.4s;
}
.envelope.open .wax-seal { opacity: 0; pointer-events: none; }

/* === PAPER / READING VIEW === */
#reading-overlay {
    position: fixed; inset: 0; z-index: 50; 
    background: rgba(0,0,0,0.6); /* Dim the desk */
    backdrop-filter: blur(8px);
    display: flex; flex-direction: column; align-items: center; justify-content: center;
    opacity: 0; pointer-events: none; transition: opacity 0.8s ease;
}
#reading-overlay.active { opacity: 1; pointer-events: auto; }

.letter-sheet {
    position: relative; 
    width: 90vw; max-width: 600px; height: 80vh;
    background: #fff;
    background-image: 
        linear-gradient(#e5e7eb 1px, transparent 1px), /* Rules */
        linear-gradient(90deg, #ef4444 1px, transparent 1px); /* Margin */
    background-size: 100% 2rem, 100% 100%;
    background-position: 0 1rem, 3rem 0;
    box-shadow: 0 25px 50px -12px rgba(0, 0, 0, 0.5);
    border-radius: 2px;
    transform: translateY(50px) scale(0.9);
    transition: transform 0.8s cubic-bezier(0.34, 1.56, 0.64, 1);
    display: flex; flex-direction: column;
    overflow: hidden;
}
#reading-overlay.active .letter-sheet { transform: translateY(0) scale(1); }

.letter-content {
    flex: 1; 
    padding: 3rem 2rem 2rem 4rem; /* Left padding clears the red margin line */
    overflow-y: hidden; /* Handled by pagination */
    position: relative;
}

/* Pagination Animation */
.page-slide {
    position: absolute; inset: 0; 
    padding: 3rem 2rem 2rem 4rem;
    font-family: 'Dancing Script', cursive; /* Elegant Font */
    font-size: 1.5rem; line-height: 2rem; color: #1e293b;
    opacity: 0; transform: translateX(20px); transition: all 0.5s ease;
    pointer-events: none;
    display: flex; flex-direction: column; justify-content: flex-start;
}
.page-slide.active { opacity: 1; transform: translateX(0); pointer-events: auto; }
.page-slide.prev { transform: translateX(-20px); opacity: 0; }

/* Controls */
.nav-btn {
    position: absolute; top: 50%; transform: translateY(-50%);
    width: 44px; height: 44px; border-radius: 50%; 
    background: #334155; color: white;
    box-shadow: 0 4px 6px rgba(0,0,0,0.3);
    display: flex; align-items: center; justify-content: center;
    cursor: pointer; transition: all 0.2s; z-index: 60;
    border: 2px solid rgba(255,255,255,0.2);
}
.nav-btn:hover { background: #475569; transform: translateY(-50%) scale(1.1); }
.nav-prev { left: -60px; } .nav-next { right: -60px; }
.nav-btn.disabled { opacity: 0; pointer-events: none; }

/* Mobile Adjustments */
@media (max-width: 640px) {
    .nav-prev { left: 10px; background: rgba(0,0,0,0.5); backdrop-filter: blur(4px); }
    .nav-next { right: 10px; background: rgba(0,0,0,0.5); backdrop-filter: blur(4px); }
    .letter-sheet { width: 95vw; height: 85vh; background-position: 0 1rem, 2rem 0; }
    .page-slide { padding: 3rem 1.5rem 2rem 2.5rem; font-size: 1.25rem; }
    .book-stack, .coffee-cup, .pen, .glasses { transform: scale(0.6); } /* Shrink decorations */
    .book-stack { top: 5%; left: -10%; }
    .coffee-cup { top: 5%; right: -5%; }
}
