/* === GLOBAL & UTILS === */
body { font-family: 'Inter', sans-serif; -webkit-font-smoothing: antialiased; overflow: hidden; }

/* Custom Scrollbar */
::-webkit-scrollbar { width: 4px; height: 4px; }
::-webkit-scrollbar-track { background: transparent; }
::-webkit-scrollbar-thumb { background: #94a3b8; border-radius: 2px; }

/* Loader */
.loader-dots div { animation-timing-function: cubic-bezier(0, 1, 1, 0); }
.loader-dots div:nth-child(1) { left: 8px; animation: loader-dots1 0.6s infinite; }
.loader-dots div:nth-child(2) { left: 8px; animation: loader-dots2 0.6s infinite; }
.loader-dots div:nth-child(3) { left: 32px; animation: loader-dots2 0.6s infinite; }
.loader-dots div:nth-child(4) { left: 56px; animation: loader-dots3 0.6s infinite; }
@keyframes loader-dots1 { 0% { transform: scale(0); } 100% { transform: scale(1); } }
@keyframes loader-dots3 { 0% { transform: scale(1); } 100% { transform: scale(0); } }
@keyframes loader-dots2 { 0% { transform: translate(0, 0); } 100% { transform: translate(24px, 0); } }

/* === CINEMATIC DESK SCENE === */
.desk-surface {
    position: absolute; inset: 0;
    background: radial-gradient(circle at 50% 50%, #5d4037 0%, #3e2723 90%);
    z-index: 0;
}
.desk-grain {
    position: absolute; inset: 0;
    opacity: 0.15;
    background-image: repeating-linear-gradient(45deg, rgba(0,0,0,0.1) 0px, rgba(0,0,0,0.1) 2px, transparent 2px, transparent 4px);
    pointer-events: none; z-index: 1;
}

/* Scene Objects (Decorations) */
.scene-object { position: absolute; pointer-events: none; filter: drop-shadow(5px 10px 10px rgba(0,0,0,0.5)); z-index: 2; }
.book-stack { top: 10%; left: 5%; font-size: 120px; color: #4a3b32; opacity: 0.8; transform: rotate(15deg); }
.coffee-cup { top: 15%; right: 10%; font-size: 80px; color: #d7ccc8; opacity: 0.9; transform: rotate(-10deg); }
.pen { bottom: 10%; right: 20%; font-size: 60px; color: #fbbf24; transform: rotate(45deg); opacity: 0.9; }

/* Interactive Stage */
.envelope-stage { 
    position: absolute; inset: 0;
    display: flex; justify-content: center; align-items: center; 
    z-index: 20; /* High Z-Index to ensure clickability */
    transition: transform 1s ease, opacity 1s ease;
}
.envelope-stage.zoomed-out { 
    transform: scale(3); opacity: 0; pointer-events: none; 
}

/* The Envelope */
.envelope-wrapper {
    position: relative;
    width: 320px; height: 220px;
    cursor: pointer;
    transform: rotate(-5deg);
    transition: transform 0.3s ease;
    animation: slideIn 1s cubic-bezier(0.25, 1, 0.5, 1) forwards;
}
@keyframes slideIn { from { transform: translateY(100vh) rotate(20deg); } to { transform: translateY(0) rotate(-5deg); } }

.envelope-wrapper:hover { transform: rotate(0deg) scale(1.05); }

.envelope {
    position: relative; width: 100%; height: 100%;
    background: #e11d48;
    border-radius: 4px;
    box-shadow: 0 25px 50px rgba(0,0,0,0.5);
    transform-style: preserve-3d;
}

/* Flap */
.envelope-flap {
    position: absolute; top: 0; left: 0; right: 0; height: 0;
    border-top: 120px solid #be123c;
    border-left: 160px solid transparent;
    border-right: 160px solid transparent;
    transform-origin: top;
    transition: transform 0.6s ease;
    z-index: 30;
}
.envelope.open .envelope-flap { transform: rotateX(180deg); z-index: 5; }

/* Pocket */
.envelope-pocket {
    position: absolute; bottom: 0; left: 0; width: 100%; height: 100%;
    z-index: 20; pointer-events: none;
}
.envelope-pocket::before {
    content: ''; position: absolute; bottom: 0; left: 0;
    border-left: 160px solid #f43f5e; border-top: 110px solid transparent; border-bottom: 110px solid #f43f5e;
}
.envelope-pocket::after {
    content: ''; position: absolute; bottom: 0; right: 0;
    border-right: 160px solid #fb7185; border-top: 110px solid transparent; border-bottom: 110px solid #fb7185;
}

/* Wax Seal */
.wax-seal {
    position: absolute; top: 55%; left: 50%; transform: translate(-50%, -50%);
    width: 50px; height: 50px;
    background: radial-gradient(circle at 30% 30%, #fcd34d, #b45309);
    border-radius: 50%;
    box-shadow: 0 4px 8px rgba(0,0,0,0.3);
    z-index: 35;
    display: flex; align-items: center; justify-content: center;
    color: #78350f; font-size: 24px;
    transition: opacity 0.3s;
}
.envelope.open .wax-seal { opacity: 0; pointer-events: none; }

/* Paper Preview (Slides up before full view) */
.paper-preview {
    position: absolute; left: 10px; right: 10px; top: 10px; bottom: 10px;
    background: white;
    z-index: 10;
    transform: translateY(0);
    transition: transform 0.8s ease 0.4s;
    border-radius: 2px;
}
.envelope.open .paper-preview { transform: translateY(-100px); }

/* === FULL READING VIEW === */
#reading-overlay {
    position: fixed; inset: 0; z-index: 50; 
    background: rgba(0,0,0,0.7); backdrop-filter: blur(8px);
    display: flex; flex-direction: column; align-items: center; justify-content: center;
    opacity: 0; pointer-events: none; transition: opacity 0.8s ease;
}
#reading-overlay.active { opacity: 1; pointer-events: auto; }

.letter-sheet {
    position: relative; 
    width: 90vw; max-width: 600px; height: 80vh;
    background: #fff;
    /* Lined Paper Pattern */
    background-image: linear-gradient(#cbd5e1 1px, transparent 1px);
    background-size: 100% 2rem;
    background-position: 0 1.5rem;
    box-shadow: 0 0 0 1px #e2e8f0, 0 20px 40px -5px rgba(0,0,0,0.3);
    transform: translateY(100px) scale(0.9);
    transition: transform 0.8s cubic-bezier(0.34, 1.56, 0.64, 1);
    border-radius: 4px;
    overflow: hidden;
}
#reading-overlay.active .letter-sheet { transform: translateY(0) scale(1); }

/* Red Margin Line */
.letter-sheet::before {
    content: ''; position: absolute; top: 0; bottom: 0; left: 3rem;
    width: 2px; background: #fca5a5; z-index: 10;
}

.letter-content {
    position: absolute; inset: 0;
    padding: 3rem 2rem 2rem 4.5rem;
    display: flex; flex-direction: column;
}

.page-slide {
    position: absolute; inset: 0;
    padding: 3rem 2rem 2rem 4.5rem;
    font-family: 'Dancing Script', cursive; 
    font-size: 1.6rem; line-height: 2rem; color: #334155;
    opacity: 0; transform: translateX(20px); transition: all 0.5s ease;
    pointer-events: none; overflow-y: auto;
}
.page-slide.active { opacity: 1; transform: translateX(0); pointer-events: auto; }
.page-slide.prev { opacity: 0; transform: translateX(-20px); }

/* Navigation */
.nav-btn {
    position: absolute; top: 50%; width: 50px; height: 50px;
    border-radius: 50%; background: white; color: #e11d48;
    box-shadow: 0 4px 12px rgba(0,0,0,0.2);
    display: flex; align-items: center; justify-content: center;
    cursor: pointer; z-index: 60; font-size: 1.2rem;
    transition: transform 0.2s, opacity 0.2s;
}
.nav-btn:hover { transform: scale(1.1); }
.nav-prev { left: 1rem; } .nav-next { right: 1rem; }
.nav-btn.disabled { opacity: 0; pointer-events: none; }

/* Mobile Adjustments */
@media (max-width: 640px) {
    .envelope-wrapper { width: 280px; height: 190px; }
    .nav-prev { left: 5px; width: 40px; height: 40px; } 
    .nav-next { right: 5px; width: 40px; height: 40px; }
    .letter-sheet { width: 95vw; height: 85vh; }
    .page-slide { font-size: 1.4rem; padding-left: 3.5rem; }
    .letter-sheet::before { left: 2.5rem; }
}
